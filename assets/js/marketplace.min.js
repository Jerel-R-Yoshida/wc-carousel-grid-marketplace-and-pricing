!function(t){"use strict";var e={debug:wc_cgmp_ajax?.debug||!1,isLoading:!0,initialized:!1,log:function(...t){this.debug&&console.log("[WC_CGMP]",...t)},currentCategory:0,currentTier:1,currentOffset:0,limit:12,init:function(){this.initialized||(this.initialized=!0,this.bindEvents(),this.initCarousel(),this.initDefaultTier(),this.syncInitialPrices(),this.syncAllPanelsFromDropdowns())},syncAllPanelsFromDropdowns:function(){t(".wc-cgmp-pricing-panel").each(function(){e.syncPanelFromDropdown(t(this))}),e.log("All panels synced from dropdowns")},syncInitialPrices:function(){var e=t(".wc-cgmp-tier-btn.active");t(".wc-cgmp-marketplace");if(e.length){var a=parseInt(e.data("tier"),10)||0;a>0&&this.updateAllPricingPanels(a)}this.hideLoading()},showLoading:function(){var e=t(".wc-cgmp-marketplace");e.addClass("wc-cgmp-loading").removeClass("wc-cgmp-loaded"),e.find(".wc-cgmp-loading-overlay").removeClass("hidden"),this.isLoading=!0},hideLoading:function(){var a=t(".wc-cgmp-marketplace");setTimeout(function(){a.removeClass("wc-cgmp-loading").addClass("wc-cgmp-loaded"),a.find(".wc-cgmp-loading-overlay").addClass("hidden"),e.isLoading=!1},100)},initDefaultTier:function(){var e=t(".wc-cgmp-tier-btn.active");e.length?this.currentTier=parseInt(e.data("tier"),10)||1:(t(".wc-cgmp-tier-btn.wc-cgmp-tier-entry").addClass("active"),this.currentTier=1)},bindEvents:function(){t(document).on("click",".wc-cgmp-category-item",this.filterByCategory),t(document).on("click",".wc-cgmp-tier-btn",this.filterByTier),t(document).on("click",".wc-cgmp-add-to-cart",this.addToCart),t(document).on("click",".wc-cgmp-headcount-btn",this.updateQuantity),t(document).on("change",".wc-cgmp-quantity-input",this.updateTotal),t(document).on("change",".wc-cgmp-tier-select",this.updateTierPrice),t(document).on("change",".wc-cgmp-switch-input",this.updatePriceType),t(document).on("click",".wc-cgmp-load-more",this.loadMore),t(document).on("input",".wc-cgmp-search-input",this.debounce(this.searchProducts,300))},filterByCategory:function(a){a.preventDefault();var i=t(this),c=i.data("category");e.currentCategory=c,e.currentOffset=0,t(".wc-cgmp-category-item").removeClass("active"),i.addClass("active"),e.loadProducts()},filterByTier:function(a){a.preventDefault();var i=t(this),c=parseInt(i.data("tier"),10)||1;c!==e.currentTier&&(e.currentTier=c,e.currentOffset=0,t(".wc-cgmp-tier-btn").removeClass("active"),i.addClass("active"),e.updateAllPricingPanels(c))},syncPanelFromDropdown:function(t){var a=t.find(".wc-cgmp-tier-select"),i=t.find(".wc-cgmp-add-to-cart");if(0!==a.length&&0!==i.length){var c=parseInt(a.val(),10)||0;c>0&&(i.attr("data-tier-level",c),e.log("Panel synced from dropdown",{product_id:t.data("product-id"),tier_level:c}))}},updateAllPricingPanels:function(a){var i=0;e.log("updateAllPricingPanels called with tierLevel:",a),t(".wc-cgmp-card").each(function(){var c=t(this),r=c.find(".wc-cgmp-pricing-panel"),n=c.find(".wc-cgmp-tier-badge"),o=(c.find(".wc-cgmp-card-desc"),parseFloat(r.attr("data-tier-"+a+"-hourly"))||0),d=parseFloat(r.attr("data-tier-"+a+"-monthly"))||0,l=r.attr("data-tier-"+a+"-name")||"",s=r.attr("data-tier-"+a+"-description")||"";if(o<=0&&d<=0)c.hide();else{c.show(),i++;var p=r.find(".wc-cgmp-switch-input").is(":checked")?"hourly":"monthly",u="monthly"===p?d:o;r.find(".wc-cgmp-price-main").data("price",u).html(e.formatPrice(u)),"monthly"===p?r.find(".wc-cgmp-price-sub").html(e.formatPrice(o)+"/hr"):r.find(".wc-cgmp-price-sub").html(e.formatPrice(d)+"/mo"),r.find(".wc-cgmp-total-price").data("monthly-price",d);var m=["entry","mid","expert"][a-1]||"default";n.removeClass("entry mid expert default").addClass(m).text(l),r.find(".wc-cgmp-tier-description").text(s);var g=r.find(".wc-cgmp-tier-select");g.length&&g.find('option[value="'+a+'"]').length&&g.val(a);var h=r.find(".wc-cgmp-add-to-cart");h.length&&h.attr("data-tier-level",a),r.find(".wc-cgmp-quantity-input").trigger("change")}}),e.log("updateAllPricingPanels complete. Visible cards:",i),e.updateSectionHeader(i)},loadProducts:function(){var a=t(".wc-cgmp-grid"),i=parseInt(a.closest(".wc-cgmp-marketplace").data("limit"),10)||e.limit;this.showLoading(),t.ajax({url:wc_cgmp_ajax.ajax_url,type:"POST",data:{action:"wc_cgmp_filter_products",nonce:wc_cgmp_ajax.nonce,category:e.currentCategory,tier:e.currentTier,limit:i,offset:e.currentOffset,show_tier_badge:a.data("show-tier-badge")??"true",show_tier_description:a.data("show-tier-description")??"true"},beforeSend:function(){a.addClass("loading")},success:function(t){t.success&&(0===e.currentOffset?a.html(t.data.html):a.append(t.data.html),e.updateSectionHeader(t.data.count),e.syncAllPanelsFromDropdowns(),e.currentTier>0&&e.updateAllPricingPanels(e.currentTier))},complete:function(){a.removeClass("loading"),e.hideLoading()}})},loadMore:function(a){a.preventDefault();var i=t(".wc-cgmp-grid"),c=t(this),r=parseInt(i.closest(".wc-cgmp-marketplace").data("limit"),10)||e.limit;e.currentOffset+=r,t.ajax({url:wc_cgmp_ajax.ajax_url,type:"POST",data:{action:"wc_cgmp_load_more",nonce:wc_cgmp_ajax.nonce,category:e.currentCategory,tier:e.currentTier,limit:r,offset:e.currentOffset,show_tier_badge:i.data("show-tier-badge")??"true",show_tier_description:i.data("show-tier-description")??"true"},beforeSend:function(){c.addClass("loading").html('<span class="dashicons dashicons-update wc-cgmp-spin"></span> Loading...')},success:function(a){a.success&&(i.append(a.data.html),a.data.has_more||t(".wc-cgmp-load-more").hide(),e.syncAllPanelsFromDropdowns(),e.currentTier>0&&e.updateAllPricingPanels(e.currentTier))},complete:function(){c.removeClass("loading").text("Load More")}})},searchProducts:function(a){var i=t(a.target).val(),c=t(".wc-cgmp-grid");if(i.length<2)return e.currentOffset=0,void e.loadProducts();e.showLoading(),t.ajax({url:wc_cgmp_ajax.ajax_url,type:"POST",data:{action:"wc_cgmp_search_products",nonce:wc_cgmp_ajax.nonce,search:i,tier:e.currentTier,limit:12,show_tier_badge:c.data("show-tier-badge")??"true",show_tier_description:c.data("show-tier-description")??"true"},success:function(t){t.success&&(c.html(t.data.html),e.updateSectionHeader(t.data.count),e.syncAllPanelsFromDropdowns(),e.currentTier>0&&e.updateAllPricingPanels(e.currentTier))},complete:function(){e.hideLoading()}})},addToCart:function(a){a.preventDefault();var i=t(this),c=i.closest(".wc-cgmp-card"),r=i.closest(".wc-cgmp-pricing-panel"),n=i.data("product-id"),o=i.attr("data-tier-level"),d=parseInt(o,10)||0,l=r.find(".wc-cgmp-switch-input").is(":checked")?"hourly":r.data("default-price-type")||"monthly",s=parseInt(r.find(".wc-cgmp-quantity-input").val(),10)||1,p=r.attr("data-tier-"+d+"-name")||"",u=parseFloat(r.attr("data-tier-"+d+"-hourly"))||0,m=parseFloat(r.attr("data-tier-"+d+"-monthly"))||0,g="monthly"===l?m:u;e.log("=== ADD TO CART CLICKED ==="),e.log("Button data-tier-level attr:",o),e.log("Parsed tierLevel:",d),e.log("ProductId:",n),e.log("PriceType:",l),e.log("Quantity:",s),e.log("Tier Name:",p),e.log("Selected Price:",g);var h=r.find(".wc-cgmp-tier-select");h.length&&(e.log("Dropdown value:",h.val()),e.log("Dropdown selected option:",h.find("option:selected").text()));var f=c.attr("data-has-tiers")||r.attr("data-has-tiers");if(e.log("hasTiers:",f),"true"===f||!0===f){if(d<=0)return e.log("ERROR: tierLevel is 0 or negative, aborting"),void alert(wc_cgmp_ajax.i18n.select_tier||"Please select an experience level.");if(e.log("Tier prices - hourly:",u,"monthly:",m,"selected:",g),g<=0){var w="monthly"===l?"Monthly pricing is not available for this experience level.":"Hourly pricing is not available for this experience level.";return e.log("ERROR: selectedPrice is 0 or negative"),void alert(wc_cgmp_ajax.i18n.invalid_price_type||w)}}var v={action:"wc_cgmp_add_to_cart",nonce:wc_cgmp_ajax.nonce,product_id:n,quantity:s,tier_level:d,price_type:l,welp_selected_tier:d,welp_tier_name:p,welp_tier_price:g,welp_price_type:l};e.log("Sending AJAX with data:",v),i.addClass("loading"),i.find(".wc-cgmp-btn-text").text("Adding..."),t.ajax({url:wc_cgmp_ajax.ajax_url,type:"POST",data:v,success:function(a){e.log("AJAX success response:",a),a.success?(i.find(".wc-cgmp-btn-text").text(wc_cgmp_ajax.i18n.added_to_cart),t(document.body).trigger("wc_fragment_refresh"),a.data.cart_data&&"function"==typeof window.cartQuoteUpdateMiniCart?window.cartQuoteUpdateMiniCart(a.data.cart_data):"function"==typeof window.cartQuoteRefreshMiniCart&&window.cartQuoteRefreshMiniCart({full:!0}),setTimeout(function(){i.find(".wc-cgmp-btn-text").text("Add to Cart")},2e3)):(e.log("AJAX returned success:false:",a.data),alert(a.data.message||wc_cgmp_ajax.i18n.error),i.find(".wc-cgmp-btn-text").text("Add to Cart"))},error:function(t,a,c){e.log("AJAX error:",{xhr:t,status:a,error:c}),alert("Error: "+c),i.find(".wc-cgmp-btn-text").text("Add to Cart")},complete:function(){i.removeClass("loading")}})},updateQuantity:function(e){e.preventDefault();var a=t(this),i=a.siblings(".wc-cgmp-quantity-input"),c=a.data("action"),r=parseInt(i.val(),10)||1;"increase"===c?i.val(Math.min(r+1,99)):"decrease"===c&&i.val(Math.max(r-1,1)),i.trigger("change")},updateTotal:function(a){var i=t(this),c=i.closest(".wc-cgmp-pricing-panel"),r=parseInt(i.val(),10)||1,n=c.attr("data-has-tiers"),o=("false"===n||!1===n?parseFloat(c.data("product-price"))||0:parseFloat(c.find(".wc-cgmp-total-price").data("monthly-price"))||0)*r;c.find(".wc-cgmp-total-price").data("total",o);var d=e.formatPrice(o);c.find(".wc-cgmp-total-price").html(d+(n?"/mo":""))},updateTierPrice:function(a){var i=t(this),c=i.closest(".wc-cgmp-pricing-panel"),r=i.find("option:selected"),n=c.find(".wc-cgmp-add-to-cart"),o=parseInt(i.val(),10)||0,d=parseFloat(r.data("hourly"))||0,l=parseFloat(r.data("monthly"))||0,s="monthly"===(c.find(".wc-cgmp-switch-input").is(":checked")?"hourly":"monthly")?l:d;c.find(".wc-cgmp-price-main").data("price",s),c.find(".wc-cgmp-price-main").html(e.formatPrice(s)),n.attr("data-tier-level",o),e.log("Dropdown changed - tier level updated",{product_id:c.data("product-id"),new_tier_level:o,button_data_tier_level:n.attr("data-tier-level"),hourly_price:d,monthly_price:l}),c.find(".wc-cgmp-quantity-input").trigger("change")},updatePriceType:function(a){var i=t(this),c=i.closest(".wc-cgmp-pricing-panel"),r=i.is(":checked")?"hourly":"monthly";c.find(".wc-cgmp-switch-label").removeClass("active"),c.find(".wc-cgmp-switch-label").eq("hourly"===r?2:0).addClass("active"),c.find(".wc-cgmp-add-to-cart").data("price-type",r);var n=parseInt(c.find(".wc-cgmp-add-to-cart").attr("data-tier-level"),10)||1,o=parseFloat(c.attr("data-tier-"+n+"-hourly"))||0,d=parseFloat(c.attr("data-tier-"+n+"-monthly"))||0,l="monthly"===r?d:o;c.find(".wc-cgmp-price-main").data("price",l).html(e.formatPrice(l)),c.find(".wc-cgmp-total-price").data("monthly-price",d),"monthly"===r?c.find(".wc-cgmp-price-sub").html(e.formatPrice(o)+"/hr"):c.find(".wc-cgmp-price-sub").html(e.formatPrice(d)+"/mo"),c.find(".wc-cgmp-quantity-input").trigger("change")},updateSectionHeader:function(e){var a=1===e?"1 role available":e+" roles available";t(".wc-cgmp-section-count").text(a)},formatPrice:function(t){return"$"+t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},debounce:function(t,e){var a;return function(){var i=this,c=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(i,c)},e)}},initCarousel:function(){var e=t(".wc-cgmp-grid.wc-cgmp-hybrid");e.length&&t(window).width()<=768&&e.attr("data-carousel","true")}};t(document).ready(function(){e.init()}),t(window).on("elementor/frontend/init",function(){elementorFrontend.hooks.addAction("frontend/element_ready/WC_CGMP_marketplace.default",function(t){e.init()})})}(jQuery);